<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="HolidayCalendar">

    <!-- 전체 목록 -->
    <select id="getAllHolidays"
            resultType="com.kedu.ggirick_client_backend.dto.common.HolidayCalendarDTO">
        SELECT
        ID,
        CAL_DATE,
        IS_WORKDAY,
        HOLIDAY_TYPE,
        DESCRIPTION,
        CREATED_AT
        FROM HOLIDAY_CALENDAR
        ORDER BY CAL_DATE
    </select>

    <!-- 연도별 조회 -->
    <select id="getByYear"
            parameterType="int"
            resultType="com.kedu.ggirick_client_backend.dto.common.HolidayCalendarDTO">
        SELECT
        ID,
        CAL_DATE,
        IS_WORKDAY,
        HOLIDAY_TYPE,
        DESCRIPTION,
        CREATED_AT
        FROM HOLIDAY_CALENDAR
        WHERE EXTRACT(YEAR FROM CAL_DATE) = #{year}
        ORDER BY CAL_DATE
    </select>

    <!-- 특정 날짜가 공휴일인지 확인 -->
    <select id="isHoliday" parameterType="java.sql.Date" resultType="boolean">
        SELECT CASE WHEN COUNT(*) > 0 THEN 1 ELSE 0 END
        FROM HOLIDAY_CALENDAR
        WHERE CAL_DATE = #{calDate}
        AND IS_WORKDAY = 'N'
    </select>

    <!-- 지정 기간 내의 공휴일 목록 조회 -->
    <select id="getHolidaysByPeriod"
            parameterType="map"
            resultType="com.kedu.ggirick_client_backend.dto.common.HolidayCalendarDTO">
        SELECT
        cal_date,
        description,
        is_workday,
        holiday_type
        FROM holiday_calendar
        WHERE cal_date BETWEEN #{startDate} AND #{endDate}
        AND NVL(is_workday, 'Y') = 'N'
        ORDER BY cal_date
    </select>
</mapper>
